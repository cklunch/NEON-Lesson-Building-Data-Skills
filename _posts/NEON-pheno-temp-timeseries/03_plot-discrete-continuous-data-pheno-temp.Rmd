---
layout: post
title: "Plot Continuous & Discrete Data Together"
date:   2017-08-01
authors: [Lee Stanish, Megan A. Jones, Natalie Robinson]
contributors: [ Katie Jones, Cody Flagg] 
dateCreated: 2017-08-01
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
packagesLibraries: [ ]
category: [self-paced-tutorial]
tags: [R, timeseries]
mainTag:  neon-pheno-temp-series
tutorialSeries:  [neon-pheno-temp-series]
description: "This tutorial discusses ways to plot plant phenology (discrete time
series) and single-aspirated temperature (continuous time series) together."
languagesTool: R
dataProduct: NEON.DP1.10055, 
code1: 
image:
  feature: codedFieldJournal.png
  credit: National Ecological Observatory Network (NEON)
  creditlink: 
permalink: /R/neon-pheno-temp-plot/
comments: true
---

{% include _toc.html %}

**R Skill Level:** Intermediate - you've got the basics of `R` down.

<div id="objectives" markdown="1">

# Objectives
After completing this activity, you will:

 * 

##Things Youâ€™ll Need To Complete This Tutorial
You will need the most current version of `R` and, preferably, `RStudio` loaded
on your computer to complete this tutorial.

###Install R Packages
* **NAME:** `install.packages("NAME")`


[More on Packages in R - Adapted from Software Carpentry.]({{site.baseurl}}R/Packages-In-R/)

###Download Data 

{% include/dataSubsets/_data_NEON-pheno-temp-timeseries.html %}

****
{% include/_greyBox-wd-rscript.html %}

****

##Additional Resources

* (links if you want to provide)

</div>


```{r import-data}

# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(gridExtra)
library(grid)
library(gtable)
library(scales)

# Set working directory

# Read in data -> if in series this is unnecessary
temp_day <- read.csv('NEON-pheno-temp-timeseries/temp/NEONsaat_daily_SCBI_2016.csv',
		stringsAsFactors = FALSE)

phe_1sp_2016 <- read.csv('NEON-pheno-temp-timeseries/pheno/NEONpheno_LITU_Leaves_SCBI_2016.csv',
		stringsAsFactors = FALSE)

# Convert dates
temp_day$sDate <- as.Date(temp_day$sDate)
phe_1sp_2016$date <- as.Date(phe_1sp_2016$date)

```


Final Plot - combo of two plots stacked (e.g. not 2 y-axes on 1 plot)

### Fix - new pheno plot with only 2016
### Dates on x-axis

```{r stacked-plots}

phenoPlot <- ggplot(phe_1sp_2016, aes(date, n.y)) +
    geom_bar(stat="identity", na.rm = TRUE) +
    ggtitle("Total Individuals in Leaf") +
    xlab("Date") + ylab("Number of Individuals") +
    theme(plot.title = element_text(lineheight=.8, face="bold", size = 20)) +
    theme(text = element_text(size=18))

phenoPlot

tempPlot_dayMax <- ggplot(temp_day, aes(sDate, dayMax)) +
    geom_point() +
    ggtitle("Daily Max Air Temperature") +
    xlab("") + ylab("Temp (C)") +
    theme(plot.title = element_text(lineheight=.8, face="bold", size = 20)) +
    theme(text = element_text(size=18))

tempPlot_dayMax


# Output with both plots
grid.arrange(phenoPlot, tempPlot_dayMax) 

```


### Format Dates in Axis Labels
Hmmm... the x-axis on both plots is kinda wonky. For the pheno data, We might 
want a different
date display format (e.g. 2016-07 vs. Jul); for the temp data there are a TON of tick
marks! These parameters can be adujusted with `scale_x_date`. Let's format the x-axis
ticks so they read "month" (`%b`) in both graphs. We will use the syntax:

`scale_x_date(labels=date_format("%b"")`

Rather than re-coding the entire plot, we can add the `scale_x_date` element
to the plot object `phenoPlot` we just created. 

<i class="fa fa-star"></i> **Data Tip:** You can type `?strptime` into the `R` 
console to find a list of date format conversion specifications (e.g. %b = month).
Type `scale_x_date` for a list of parameters that allow you to format dates 
on the x-axis.
{: .notice }


<i class="fa fa-star"></i> **Data Tip:** If you are working with a date & time
class (e.g. POSIXct), you can use `scale_x_datetime` instead of `scale_x_date`.
{: .notice }

```{r format-x-axis-labels }
# format x-axis: dates
phenoPlot_pretty <- phenoPlot + 
  (scale_x_date(breaks = date_breaks("months"), labels = date_format("%b")))

phenoPlot_pretty

tempPlot_dayMax_pretty <- tempPlot_dayMax +
  (scale_x_date(breaks = date_breaks("months"), labels = date_format("%b")))

tempPlot_dayMax_pretty

# Output with both plots
grid.arrange(phenoPlot_pretty, tempPlot_dayMax_pretty) 

```

### Align datasets

We have different start and end dates, which makes it harder to see trends. 
Let's align the datasets and replot

```{r align-datasets-replot }
# align dates
temp_day_fit <- filter(temp_day,sDate >= min(phe_1sp_2016$date) & sDate <= max(phe_1sp_2016$date))

# Check it
range(phe_1sp_2016$date)
range(temp_day_fit$sDate)

#plot again
tempPlot_dayMax_corr <- ggplot(temp_day_fit, aes(sDate, dayMax)) +
    geom_point() +
    scale_x_date(breaks = date_breaks("months"), labels = date_format("%b")) +
    ggtitle("Daily Max Air Temperature") +
    xlab("") + ylab("Temp (C)") +
    theme(plot.title = element_text(lineheight=.8, face="bold", size = 20)) +
    theme(text = element_text(size=18))

grid.arrange(phenoPlot_pretty, tempPlot_dayMax_corr)

```

## Same plot with two Y-axes?

What about layering these plots and having two y-axes (right and left) that have
the different scale bars. This might look cool. 

However, some argue that you should not do this as it 
can distort what is actually going on with the data. The author of the ggplot2 
package is one of these individuals. Therefore, you cannot use `ggplot()` to 
create a single plot with multiple Y scales. You can read his own discussion of
the topic on this 
<a href="https://stackoverflow.com/questions/3099219/plot-with-2-y-axes-one-y-axis-on-the-left-and-another-y-axis-on-the-right/3101876#3101876"> target="_blank" StackOverflow post</a>.
